import report.ReportCreator;
import report.ReportInformation;
import utils.FileHelper;
import vulnerabilities.Vulnerability;
import vulnerabilities.VulnerabilityFactory;
import vulnerabilities.impl.BufferOverflowVulnerability;

import java.util.ArrayList;
import java.util.List;

public class VulnerabilityAnalyzerLauncher {

    private final List<String> activeVulnerability;
    private final String pathToSourceFile;
    private final String pathToReportFolder;

    public VulnerabilityAnalyzerLauncher(List<String> activeAbstractVulnerability
            , String pathToSourceFile, String pathToReportFolder) {
        this.activeVulnerability = activeAbstractVulnerability;
        this.pathToSourceFile = pathToSourceFile;
        this.pathToReportFolder = pathToReportFolder;
    }

    public void launchAnalysis() {
        List<String> sourceCode = FileHelper.readDataFromCppFile(pathToSourceFile);
        VulnerabilityFactory factory = new VulnerabilityFactory();
        List<ReportInformation> reportInformation = new ArrayList<>();
        for (String vulnerabilityName : activeVulnerability) {
            Vulnerability vulnerability = factory.getVulnerabilityInstance(vulnerabilityName);
            List<ReportInformation> curVulnerabilityReportInformation = vulnerability.checkRules(sourceCode);
            if (curVulnerabilityReportInformation.size() != 0) {
                reportInformation.addAll(curVulnerabilityReportInformation);
            }
        }
        ReportCreator.createHtmlReport(pathToSourceFile, pathToReportFolder, reportInformation);
    }

    public static void main(String[] args) {
        Vulnerability vulnerability = new BufferOverflowVulnerability();
//        List<String> list = new ArrayList<>();
//        list.add("bufferOverflow");
//        VulnerabilityAnalyzerLauncher launcher = new VulnerabilityAnalyzerLauncher(list
//                , "C:\\Users\\frolo\\IdeaProjects\\testest\\vulnerability_analyzer\\analyzer-library\\src\\main\\resources\\test.cpp"
//                , "C:\\Users\\frolo\\Desktop\\reportFolder");
//        launcher.launchAnalysis();
    }
}
