package com.example.gui_for_course;

import java.io.*;
import java.net.URL;
import java.util.List;
import java.util.ResourceBundle;

import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.stage.DirectoryChooser;
import javafx.stage.FileChooser;
import javafx.stage.Stage;

public class Controller {

    @FXML
    private ResourceBundle resources;

    @FXML
    private URL location;

    @FXML
    private Button buttonDirectoryChoose;

    @FXML
    private Button buttonFileChoose;

    @FXML
    private Button buttonSaveFile;

    @FXML
    private Button buttonStart;

    @FXML
    private TextArea codeCpp;

    @FXML
    private TextField pathChoosenDirectoryForSave;

    @FXML
    private TextField pathChoosenFile;

    public Controller() {
    }

    @FXML
    void initialize() {

    }

    private void printLog(TextField textField, List<File> files) {
        if (files == null || files.isEmpty()) {
            return;
        }
        for (File file : files) {
            textField.appendText(file.getAbsolutePath() + "\n");
        }
    }

    private String filePath;
    public String getFilePath() {
        return filePath;
    }
    public void fileChoosen(ActionEvent actionEvent) throws IOException {
        FileChooser fileChooser = new FileChooser();
        Stage primaryStage = new Stage();
        pathChoosenFile.clear();
        fileChooser.setInitialDirectory(new File("C:\\"));
        fileChooser.setTitle("Select cpp file: ");
        fileChooser.getExtensionFilters().add(new FileChooser.ExtensionFilter(".cpp", "*.cpp"));
        File file = fileChooser.showOpenDialog(primaryStage);
        if (file != null) {
            List<File> files = List.of(file);
            printLog(pathChoosenFile, files);
            filePath = file.getAbsolutePath();
        }
        System.out.println(filePath);
        printToCodeCpp();
    }

    private void printToCodeCpp() throws IOException {
        codeCpp.clear();
        BufferedReader br = new BufferedReader(new FileReader(filePath));
        String line = null;
        while ((line = br.readLine()) != null) {
            codeCpp.appendText(line + '\n');
        }
    }

    private String directoryPath;
    public String getDirectoryPath() {
        return directoryPath;
    }
    public void directoryChoosen(ActionEvent actionEvent) {
        DirectoryChooser directoryChooser = new DirectoryChooser();
        Stage primaryStage = new Stage();
        pathChoosenDirectoryForSave.clear();
        directoryChooser.setInitialDirectory(new File("C:\\"));
        directoryChooser.setTitle("Select directory for save: ");
        File file = directoryChooser.showDialog(primaryStage);
        if (file != null) {
            List<File> files = List.of(file);
            printLog(pathChoosenDirectoryForSave, files);
            directoryPath = file.getAbsolutePath();
        }
        System.out.println(directoryPath);
    }

    public void startAnalyzer(ActionEvent actionEvent) {
    }

    public void saveReport(ActionEvent actionEvent) {
    }
}
